(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{4897:function(t,e,a){"use strict"},"49f7":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"constrain-more q-pa-none"},[t._v("\n    "+t._s(t.showHidePopup)+"\n\t\t"),a("q-item",{staticClass:"q-px-xs q-pt-sm q-ma-none"},[a("q-item-section",{staticClass:"q-ml-xs",attrs:{avatar:""}},[a("q-avatar",{staticClass:"q-mx-none shadow-1",attrs:{size:"45px"}},[a("img",{staticStyle:{border:"2px solid white","border-radius":"50%","object-fit":"cover"},attrs:{src:t.myDetails.faceIconURL}}),a("q-badge",{staticStyle:{"border-radius":"100%",border:"2px solid white",padding:"6.5px 6.5px",margin:"1px 1px"},attrs:{floating:"",round:"",color:"light-green-14"}})],1)],1),a("q-item-section",[a("q-item-label",{staticClass:"text-weight-medium ",staticStyle:{"margin-left":"-7px","font-size":"17px","margin-top":"1px"}},[t._v(t._s(t.myDetails.name))]),a("q-item-label",{staticClass:"text-caption ",staticStyle:{"margin-left":"-7px","font-size":"11px","margin-top":"2px"},attrs:{caption:""}})],1),a("q-space"),a("q-btn",{staticClass:"q-pa-none q-ma-sm",staticStyle:{height:"26px"},attrs:{bordered:"",dense:"",outline:"",color:"grey-7"}},[a("q-badge",{staticClass:"q-px-sm q-py-none q-ma-none text-weight-regular",staticStyle:{"font-size":"12px","padding-bottom":"0px","margin-bottom":"2px"},attrs:{dense:"",flat:"","text-color":"grey-7",color:"transparent"}},[a("q-icon",{staticClass:"q-my-none q-pb-none q-mr-xs",attrs:{name:"public",color:"grey-7",size:"14px"}}),t._v("\n\t\t\t\t\t"+t._s(t.openPost.desc)+"\n\t\t\t\t\t"),a("q-icon",{staticClass:"q-my-none q-pb-none",attrs:{name:"expand_more",color:"grey-7",size:"13px"}})],1),a("q-menu",{attrs:{fit:""}},[a("q-list",{staticStyle:{"min-width":"100px"}},t._l(t.openPostOptions,(function(e,i){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"},{name:"close-popup",rawName:"v-close-popup"}],key:i,staticClass:"q-px-sm q-py-none",attrs:{dense:"",clickable:""},on:{click:function(a){t.openPost=e}}},[a("q-item-section",{staticStyle:{"max-height":"38px"}},[t._v(t._s(e.desc))]),a("q-separator")],1)})),1)],1)],1)],1),a("div",{staticClass:"q-px-md q-mt-none q-py-none",staticStyle:{width:"100vw"}},[a("q-input",{staticStyle:{"font-size":"16px"},attrs:{borderless:"","bg-color":"white",standout:"bg-white text-grey-8 ",dense:t.dense,"label-slot":"",autogrow:""},scopedSlots:t._u([{key:"label",fn:function(){return[a("strong",{staticClass:"text-grey-7 text-subtitle1 text-weight-regular"},[t._v("오늘 하루 어떠셨나요?")])]},proxy:!0}]),model:{value:t.post.caption,callback:function(e){t.$set(t.post,"caption",e)},expression:"post.caption"}})],1),a("q-input",{ref:"myFileInput",staticClass:"q-py-xs q-px-md",staticStyle:{display:"none"},attrs:{type:"file"},on:{input:t.loadImageCallback},model:{value:t.media,callback:function(e){t.media=e},expression:"media"}}),a("div",{staticClass:"camera-frame q-pa-none"},[t.media?a("q-btn",{staticClass:"absolute",staticStyle:{right:"7px","margin-top":"10px","font-size":"13px",padding:"1px","background-color":"#000000a8"},attrs:{flat:"",icon:"close","text-color":"white",padding:"none"},on:{click:t.clearImages}}):t._e(),a("q-media-player",{directives:[{name:"show",rawName:"v-show",value:t.videoPreview,expression:"videoPreview"}],ref:"mediaplayer",attrs:{type:"video",autoplay:"",source:t.itemUrl}}),a("video",{directives:[{name:"show",rawName:"v-show",value:t.cameraPreview,expression:"cameraPreview"}],ref:"video",staticClass:"full-width",attrs:{autoplay:""}}),a("canvas",{directives:[{name:"show",rawName:"v-show",value:t.picturePreview,expression:"picturePreview"}],ref:"canvas",staticClass:"full-width",attrs:{height:"240"}})],1),a("div",{staticClass:"text-center q-pa-md"},[t.hasCameraSupport?a("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.cameraPreview,expression:"cameraPreview"}],attrs:{disable:!t.cameraPreview,size:"lg",round:"",color:"primary",icon:"mail"},on:{click:t.captureImage}}):t._e()],1),a("q-dialog",{attrs:{seamless:"",position:"top"},model:{value:t.showFlag,callback:function(e){t.showFlag=e},expression:"showFlag"}},[a("q-card",{staticClass:"row q-mt-none  ",staticStyle:{"max-width":"100%"},attrs:{flat:""}},[t.$route.fullPath.includes("/newpost")?a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"},{name:"go-back",rawName:"v-go-back.single",modifiers:{single:!0}}],staticClass:"col q-px-xs q-ma-sm justify-start ",attrs:{icon:"close",size:"15px",flat:"",dense:""}}):t._e(),a("div",{staticClass:"q-py-sm col-8 text-center text-subtitle1 text-weight-medium",staticStyle:{"font-size":"17px",padding:"11px"}},[t._v("새로운 소식")]),a("q-btn",{staticClass:"col q-px-sm q-py-none q-ma-sm justify-end",attrs:{disable:!t.post.photo&&!t.post.videomp,unelevated:"",bordered:"",dense:"",color:"primary",label:"Done"},on:{click:function(e){return t.addPost()}}})],1)],1),a("q-dialog",{attrs:{seamless:"",position:t.position},model:{value:t.showFlag,callback:function(e){t.showFlag=e},expression:"showFlag"}},[a("q-card",{staticStyle:{width:"100vw",height:"11.5vh"}},[a("q-linear-progress",{attrs:{value:1,color:"pink"}}),a("q-card-section",{staticClass:"row items-center no-wrap"},[a("div",[a("div",{staticClass:"text-weight-bold"},[t._v("\n\t\t\t\t\t\t\t업로드할 이미지 선택\n\t\t\t\t\t\t")])]),a("q-space"),a("q-btn",{staticClass:"q-mx-sm bg-grey-3",attrs:{flat:"",outline:"",round:"",icon:"perm_media",color:"grey-7",size:"16px"},on:{click:t.getFile}}),a("q-btn",{staticClass:"q-mx-sm bg-grey-3",attrs:{flat:"",outline:"",round:"",icon:"camera_enhance",color:"grey-7",size:"16px",disable:!t.hasCameraSupport},on:{click:t.getFileFromCamera}})],1)],1)],1)],1)},s=[],o=a("c973"),n=a.n(o),r=a("ded3"),c=a.n(r),l=(a("96cf"),a("caad"),a("2532"),a("b0c0"),a("ac1f"),a("1276"),a("c19f"),a("ace4"),a("d3b7"),a("e260"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("159b"),a("99af"),a("b64b"),a("1732"),a("2f62"));a("afb9"),a("4897");a("121f");var p={name:"newpost",data:function(){return{showFlag:!0,hasCameraSupport:!1,cameraPreview:!1,videoPreview:!1,picturePreview:!1,post:{name:{},caption:"",location:"",photo:null,filetype:"",videomp:null,date:Date.now(),opened:""},imageUpload:[],locationLoading:!1,media:null,itemUrl:null,itemfile:!1,seamless:!1,position:"bottom",text:"",dense:!1,openPost:null,openPostOptions:[{id:"all",desc:"전체공개"},{id:"follow",desc:"팔로워만"},{id:"paid",desc:"유료컨텐츠"}]}},components:{},computed:c()(c()(c()({},Object(l["e"])("store",["userDetails","myDetails"])),Object(l["c"])("store",["users"])),{},{showHidePopup:function(){this.$route.fullPath.includes("/newpost")?this.showFlag=!0:this.showFlag=!1},locationSupported:function(){return"geolocation"in navigator}}),watch:{media:function(t){t&&t.length>0&&this.loadFileBlob(t)}},created:function(){this.openPost=this.openPostOptions[0]},mounted:function(){void 0!==navigator.mediaDevices.getUserMedia?this.hasCameraSupport=!0:(this.hasCameraSupport=!1,this.cameraPreview=!1),this.post.name=this.myDetails.name},beforeDestroy:function(){this.hasCameraSupport&&(!0===this.cameraPreview&&this.disableCamera(),this.cameraPreview=!1)},methods:c()(c()({},Object(l["b"])("store",["requestPosting","requestTimelineUpdate","firebaseSendPostInfo","firebaseLikePut"])),{},{getFile:function(){this.$refs.myFileInput.$el.click(),!0===this.cameraPreview&&this.disableCamera(),this.cameraPreview=!1,this.hasCameraSupport=!0},getFileFromCamera:function(){this.media=null,this.picturePreview=!1,this.cameraPreview=!0,this.hasCameraSupport=!0,this.initCamera()},initCamera:function(){var t=this;navigator.mediaDevices.getUserMedia({video:!0}).then((function(e){t.$refs.video.srcObject=e})).catch((function(e){t.hasCameraSupport=!1,!0===t.cameraPreview&&t.disableCamera(),t.cameraPreview=!1}))},loadImageCallback:function(t){var e=this;this.post.filetype=t[0].type;var a=this.$refs.canvas,i=a.getContext("2d"),s=new FileReader;"image/jpeg"===t[0].type||"image/png"===t[0].type?(s.onload=function(t){var s=new Image;s.onload=function(){a.width=s.width,a.height=s.height,i.drawImage(s,0,0),e.picturePreview=!0,e.videoPreview=!1,!0===e.cameraPreview&&e.disableCamera(),e.cameraPreview=!1},s.src=t.target.result,e.post.photo=t.target.result,e.post.videomp=null,console.log(e.post.photo)},s.readAsDataURL(t[0])):"video/mp4"===t[0].type&&(s.onload=function(t){e.post.photo=null,e.post.videomp=t.target.result},s.readAsDataURL(t[0]),this.picturePreview=!1,this.videoPreview=!0,!0===this.cameraPreview&&this.disableCamera(),this.cameraPreview=!1)},captureImage:function(){var t=this.$refs.video,e=this.$refs.canvas;e.width=t.getBoundingClientRect().width,e.height=t.getBoundingClientRect().height;var a=e.getContext("2d");a.drawImage(t,0,0,e.width,e.height),this.picturePreview=!0,this.videoPreview=!1,this.cameraPreview=!1,this.hasCameraSupport=!0,this.post.photo=this.dataURItoBlob(e.toDataURL()),this.disableCamera()},dataURItoBlob:function(t){for(var e=atob(t.split(",")[1]),a=t.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(e.length),s=new Uint8Array(i),o=0;o<e.length;o++)s[o]=e.charCodeAt(o);var n=new Blob([i],{type:a});return n},disableCamera:function(){this.$refs.video.srcObject.getVideoTracks().forEach((function(t){t.stop()}))},clearImages:function(){this.media=null,this.post.photo=null,this.post.videomp=null,this.picturePreview=!1,this.videoPreview=!1},getLocation:function(){var t=this;this.locationLoading=!0,navigator.geolocation.getCurrentPosition((function(e){t.getCityAndCountry(e)}),(function(e){t.locationError()}),{timeout:7e3})},getCityAndCountry:function(t){var e=this,a="https://geocode.xyz/".concat(t.coords.latitude,",").concat(t.coords.longitude,"?json=1");this.$axios.get(a).then((function(t){e.locationSuccess(t)})).catch((function(t){e.locationError()}))},locationSuccess:function(t){this.post.location=t.data.city,t.data.country&&(this.post.location+=", ".concat(t.data.country)),this.locationLoading=!1},locationError:function(){this.$q.dialog({title:"Error",message:"Could not find your location"}),this.locationLoading=!1},addPost:function(){var t=this;return n()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.post.opened=t.openPost.id,console.log("send posting : "+JSON.stringify(t.post)),e.next=4,t.requestPosting(t.post);case 4:return e.sent,e.next=7,t.requestTimelineUpdate();case 7:e.sent,t.$router.back();case 9:case"end":return e.stop()}}),e)})))()},onRejected:function(t){this.$q.notify({type:"negative",message:"".concat(t.length," file(s) did not pass validation constraints")})},loadFileBlob:function(t){this.$refs.mediaplayer.loadFileBlob(t)},sendPostInfo:function(){console.log("0aaa",this.post.imageUrl),this.firebaseSendPostInfo({name:this.post.name,userIds:this.post.userIds,hashtags:this.post.hashtags,hashtagsa:this.post.hashtagsa,hashtagsb:this.post.hashtagsb,caption:this.post.caption,location:this.post.location,photo:this.post.imageUrl,videomp:this.post.imageUrl,filetype:this.post.filetype,commentCount:this.post.commentCount,likesCount:this.post.likesCount,date:this.post.date}),console.log("0aaa",this.post.imageUrl)},getPosts:function(){var t=this;this.loadingPosts=!0,this.$axios.get("".concat("http://localhost:3000","/posts")).then((function(e){console.log(e.data),Object.keys(e.data).forEach((function(a){console.log("key is",a),console.log("paramsId",t.post.id),e.data[a].id===t.post.id&&(console.log("0a",e.data[a].id),t.post.imageUrl=e.data[a].imageUrl,console.log("0aa",e.data[a].imageUrl),console.log("0aaa",t.post.imageUrl))})),t.sendPostInfo(),t.loadingPosts=!1})).catch((function(e){t.$q.dialog({title:"Error",message:"Could not find your locationb"}),t.loadingPosts=!1}))},open:function(t){this.seamless=!1,this.showFlag=!0,this.position="bottom"}})},d=p,m=(a("faf7"),a("2877")),u=a("9989"),h=a("66e5"),g=a("4074"),f=a("cb32"),v=a("58a81"),w=a("0170"),b=a("9c40"),x=a("0016"),y=a("2c91"),q=a("4e73"),C=a("1c1c"),P=a("eb85"),S=a("27f9"),k=a("7d53"),I=a("24e8"),F=a("f09f"),U=a("6b1d"),_=a("a370"),Q=a("714f"),$=a("7f67"),z=a("2eeb"),D=a("eebe"),j=a.n(D),L=Object(m["a"])(d,i,s,!1,null,null,null);e["default"]=L.exports;j()(L,"components",{QPage:u["a"],QItem:h["a"],QItemSection:g["a"],QAvatar:f["a"],QBadge:v["a"],QItemLabel:w["a"],QBtn:b["a"],QIcon:x["a"],QSpace:y["a"],QMenu:q["a"],QList:C["a"],QSeparator:P["a"],QInput:S["a"],QFile:k["a"],QDialog:I["a"],QCard:F["a"],QLinearProgress:U["a"],QCardSection:_["a"]}),j()(L,"directives",{Ripple:Q["a"],ClosePopup:$["a"],GoBack:z["a"]})},d7cc:function(t,e,a){},faf7:function(t,e,a){"use strict";a("d7cc")}}]);