<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>신한 퀴즈캐치AR</title>
    <script src='https://aframe.io/releases/0.9.2/aframe.min.js'></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
	<script src="aframe-super-shooter-kit.min.js"></script>
    <script>
        THREEx.ArToolkitContext.baseURL = 'https://raw.githack.com/jeromeetienne/ar.js/master/three.js/'
    </script>
    <script src="./gyro-camera.js"></script>
    <script src="./gyro-entity-object.js"></script>
    <script src="./script.js"></script>
    <link rel="stylesheet" type="text/css" href="./style.css"/>
</head>

<script>
	AFRAME.registerComponent('arrowshoot', {
        init: function () {
					this.restart(0);
				},

				restart: function(whattime) {
					this.direction = this.el.object3D.rotation;
					this.moveSpeed = -0.05;
					this.initflag = true;
				},
      
        tick: function (time) {
					this.el.object3D.translateZ(this.moveSpeed);
/*					
					if ( this.initflag ) {
						this.el.parentNode.removeChild(this.el);
						let scene = document.querySelector('a-scene');
						scene.appendChild(this.el);
						this.initflag = false;
					} else {

						this.el.object3D.translateZ(this.moveSpeed);
					}
*/					
        }
	});

	AFRAME.registerComponent('moveanywhere', {
        init: function () {
					this.restart(0);
				},

				restart: function(whattime) {
					this.random_x = ((Math.random() * 2) - 1);
					this.random_z = ((Math.random() * 90) - 45);
					this.random_time = whattime + ((Math.random() * 5) * 1000) + 1000;

					var move = this.el.object3D.rotation;
					move.z = THREE.Math.degToRad(this.random_z);
					this.el.object3D.rotation = move;
				},
      
        tick: function (time) {
					this.el.object3D.rotateX(THREE.Math.degToRad(this.random_x));

					if ( time > this.random_time ) {
						this.restart(time);
					}
        }
	});

	AFRAME.registerComponent('molystart', {
        init: function () {
					this.random_x = 0.5;//((Math.random() * 2) - 1)/10;
					this.random_z = 30;
					this.initflag = true;

					var move = this.el.object3D.rotation;
					move.z = THREE.Math.degToRad(this.random_z);
					this.el.object3D.rotation = move;
				},
      
        tick: function (time) {
					this.el.object3D.rotateX(THREE.Math.degToRad(this.random_x));

					// Entry#1. 시작버튼 누르면 몰리캐릭터가 2시방향으로 날아감
					if ( this.initflag ) {
						this.starttime = time;
						this.initflag = false;
					} else {
						if ( time - this.starttime > 1800 ) {
							// Entry#2. 1.8초후 리노캐릭터 생성 
							document.getElementById('rinomodel').setAttribute('rinostart','');
						}
						if ( time - this.starttime > 3000 ) {
							this.el.object3D.visible = false;
							document.getElementById('molymodel').removeAttribute('molystart');
						}
					}	
        }
	});
	AFRAME.registerComponent('rinostart', {
        init: function () {
					this.random_x = 0.5;//((Math.random() * 2) - 1)/10;
					this.random_z = -30;
					this.initflag = true;

					var move = this.el.object3D.rotation;
					move.z = THREE.Math.degToRad(this.random_z);
					this.el.object3D.rotation = move;

					console.log('move dir : ' + this.random_x + "," + this.random_z);
				},
      
        tick: function (time) {
					this.el.object3D.rotateX(THREE.Math.degToRad(this.random_x));

					// Entry#3. 리노캐릭터가 10시방향으로 날아감
					if ( this.initflag ) {
						this.starttime = time;
						this.initflag = false;
					} else {
						// Entry#4. 0.8초 후에 슈캐릭터 생성 
						if ( time - this.starttime > 800 ) {
							document.getElementById('suemodel').setAttribute('suestart','');
						}
						if ( time - this.starttime > 3000 ) {
							this.el.object3D.visible = false;
							document.getElementById('rinomodel').removeAttribute('rinostart');
						}
					}	
				}
	});
	AFRAME.registerComponent('suestart', {
        init: function () {
					this.random_x = 0.5;//((Math.random() * 2) - 1)/10;
					this.random_z = 15;
					this.initflag = true;

					var move = this.el.object3D.rotation;
					move.z = THREE.Math.degToRad(this.random_z);
					this.el.object3D.rotation = move;
				},
      
        tick: function (time) {
					this.el.object3D.rotateX(THREE.Math.degToRad(this.random_x));

					// Entry#5. 슈캐릭터 1시 방향으로 날아감
					if ( this.initflag ) {
						this.starttime = time;
						this.initflag = false;
					} else {
					// Entry#6. 1.2초후에 루루라라 캐릭터 생성
					if ( time - this.starttime > 1200 ) {
							document.getElementById('lulamodel').setAttribute('lulastart','');
						}
						if ( time - this.starttime > 3000 ) {
							this.el.object3D.visible = false;
							document.getElementById('suemodel').removeAttribute('suestart');
						}
					}	
        }
	});
	AFRAME.registerComponent('lulastart', {
        init: function () {
					this.random_x = 0.5;//((Math.random() * 2) - 1)/10;
					this.random_z = -45;
					this.initflag = true;

					var move = this.el.object3D.rotation;
					move.z = THREE.Math.degToRad(this.random_z);
					this.el.object3D.rotation = move;

					console.log('move dir : ' + this.random_x + "," + this.random_z);
				},
      
        tick: function (time) {
					this.el.object3D.rotateX(THREE.Math.degToRad(this.random_x));

					// Entry#7. 루루라라캐릭터 9시 방향으로 날아감
					if ( this.initflag ) {
						this.starttime = time;
						this.initflag = false;
					} else {
						// Entry#8. 0.4초후 도레미캐릭터 생성 
						if ( time - this.starttime > 400 ) {
							document.getElementById('doremodel').setAttribute('dorestart','');
						}
						if ( time - this.starttime > 3000 ) {
							this.el.object3D.visible = false;
							document.getElementById('lulamodel').removeAttribute('lulastart');
						}
					}	
        }
	});
	AFRAME.registerComponent('dorestart', {
        init: function () {
					this.random_x = 0.5;//((Math.random() * 2) - 1)/10;
					this.random_z = 60;
					this.initflag = true;

					var move = this.el.object3D.rotation;
					move.z = THREE.Math.degToRad(this.random_z);
					this.el.object3D.rotation = move;

					console.log('move dir : ' + this.random_x + "," + this.random_z);
				},
      
        tick: function (time) {
					this.el.object3D.rotateX(THREE.Math.degToRad(this.random_x));
					// Entry#9. 도레미캐릭터가 4시 방향으로 날아감
					if ( this.initflag ) {
						this.starttime = time;
						this.initflag = false;
					} else {
						// Entry#10. 1.2초후 솔 캐릭터 생성
						if ( time - this.starttime > 1200 ) {
							document.getElementById('solmodel').setAttribute('solstart','');
						}
						if ( time - this.starttime > 3000 ) {
							this.el.object3D.visible = false;
							document.getElementById('doremodel').removeAttribute('dorestart');
						}

					}	
        }
	});
	AFRAME.registerComponent('solstart', {
        init: function () {
					this.random_x = 0.5;//((Math.random() * 2) - 1)/10;
					this.random_z = 0;
					this.initflag = true;

					var move = this.el.object3D.rotation;
					move.z = THREE.Math.degToRad(this.random_z);
					this.el.object3D.rotation = move;

					console.log('move dir : ' + this.random_x + "," + this.random_z);
				},
      
        tick: function (time) {
					this.el.object3D.rotateX(THREE.Math.degToRad(this.random_x));

					// Entry#11. 솔캐릭터 위쪽으로 날아감
					if ( this.initflag ) {
						this.starttime = time;
						this.initflag = false;
					} else {
						// Entry#12. 2초후에 카운트 다운 시작
						if ( time - this.starttime > 2000 ) {

							console.log('initialized');
							document.getElementById('countdowndetail').innerText = "Ready!";
							document.getElementById('countdowntext').style.display = "block";
							this.counter = 5;
							this.intervalId = setInterval(() => {
									this.counter--;
									console.log(this.counter);
									if ( this.counter === 0 ) {	// Entry#13 - UX표시 된 후 게임 시작
										document.getElementById('countdowntext').style.display = "none";
										clearInterval(this.intervalId);

										document.getElementById('molymodel').object3D.visible = true;
										document.getElementById('molymodel').setAttribute('moveanywhere','');
										document.getElementById('rinomodel').object3D.visible = true;
										document.getElementById('rinomodel').setAttribute('moveanywhere','');
										document.getElementById('suemodel').object3D.visible = true;
										document.getElementById('suemodel').setAttribute('moveanywhere','');
										document.getElementById('lulamodel').object3D.visible = true;
										document.getElementById('lulamodel').setAttribute('moveanywhere','');
										document.getElementById('doremodel').object3D.visible = true;
										document.getElementById('doremodel').setAttribute('moveanywhere','');
										document.getElementById('solmodel').object3D.visible = true;
										document.getElementById('solmodel').setAttribute('moveanywhere','');
									} else
									if ( this.counter === 1 ) {		// Entry#13 - 카운트다운 끝나고 UX표시
										var entity = document.getElementById('startbell');
										entity.components.sound.playSound();        

										document.getElementById('countdowndetail').innerText = "It's Catch Time!";

										// 게임 UX 표시
						        document.getElementById('gameux').style.display = 'block';
						        document.getElementById('gun').object3D.visible = true;
									} else {
										var entity = document.getElementById('countdownsound');
										entity.components.sound.playSound();        

										document.getElementById('countdowndetail').innerText = (this.counter-1)+"!";
									}
								}, 1000);

							this.el.object3D.visible = false;
							document.getElementById('solmodel').removeAttribute('solstart');
						}
					}	

        }
	});
</script>



<body style='margin: 0; overflow: hidden;'>
    <div class="centered instructions"></div>
    <a-scene 
        vr-mode-ui='enabled: false' 
        embedded
        arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;'>
			<a-assets>
				<audio id="background" src="./assets/sound/background.mp3" preload="auto"></audio>
				<audio id="miss" src="./assets/sound/miss.mp3" preload="auto"></audio>
				<audio id="shoot1" src="./assets/sound/shoot1.mp3" preload="auto"></audio>
				<audio id="shoot2" src="./assets/sound/shoot2.mp3" preload="auto"></audio>
				<audio id="timeclick" src="./assets/sound/timeclick.mp3" preload="auto"></audio>
				<audio id="startsound" src="./assets/sound/startsound.mp3" preload="auto"></audio>
				<audio id="wrong" src="./assets/sound/wrong.mp3" preload="auto"></audio>
				<audio id="correct" src="./assets/sound/correct.mp3" preload="auto"></audio>
				<audio id="countdown" src="./assets/sound/countdown.mp3" preload="auto"></audio>
				<audio id="hitted" src="./assets/sound/hitted.mp3" preload="auto"></audio>
		  	</a-assets>		

				<a-entity 
					id="bulletTemplate" 
					bullet 
					gltf-model="url(./assets/arrow.gltf)"
					scale="5.0 5.0 5.0"
				>
				</a-entity>
<!--
			  <a-entity class="target" target="healthPoints: 10" geometry="primitive: box" material="color: teal" position="0 0 -4" hit-handler></a-entity>
-->

				<!-- 회전축 -->
			  <a-entity id="solmodel" position="0 0 0">
					<a-entity class="target" target="healthPoints: 2" gltf-model="url(./assets/solchar.gltf)" position="0 0 -4" scale="0.5 0.5 0.5" rotation="0 0 0" brandon-hit hit-handler animation-mixer="clip: fly; loop: repeat;"></a-entity>
				</a-entity>
			  <a-entity id="molymodel" position="0 0 0">
					<a-entity class="target" target="healthPoints: 2" gltf-model="url(./assets/solchar.gltf)" position="0 0 -4" scale="0.5 0.5 0.5" rotation="0 0 0" hit-handler animation-mixer="clip: fly; loop: repeat;"></a-entity>
				</a-entity>
				<a-entity id="rinomodel" position="0 0 0">
					<a-entity class="target" target="healthPoints: 2" gltf-model="url(./assets/solchar.gltf)" position="0 0 -4" scale="0.5 0.5 0.5" rotation="0 0 0" hit-handler animation-mixer="clip: fly; loop: repeat;"></a-entity>
				</a-entity>
				<a-entity id="suemodel" position="0 0 0">
					<a-entity class="target" target="healthPoints: 2" gltf-model="url(./assets/solchar.gltf)" position="0 0 -4" scale="0.5 0.5 0.5" rotation="0 0 0" hit-handler animation-mixer="clip: fly; loop: repeat;"></a-entity>
				</a-entity>
				<a-entity id="lulamodel" position="0 0 0">
					<a-entity class="target" target="healthPoints: 2" gltf-model="url(./assets/solchar.gltf)" position="0 0 -4" scale="0.5 0.5 0.5" rotation="0 0 0" hit-handler animation-mixer="clip: fly; loop: repeat;"></a-entity>
				</a-entity>
				<a-entity id="doremodel" position="0 0 0">
					<a-entity class="target" target="healthPoints: 2" gltf-model="url(./assets/solchar.gltf)" position="0 0 -4" scale="0.5 0.5 0.5" rotation="0 0 0" hit-handler animation-mixer="clip: fly; loop: repeat;"></a-entity>
				</a-entity>
<!--				
				<a-assets>
					<img id="shinhanlogoimg" src="./assets/first_start/solquiz_logo.png"/>    
					<img id="startgameimg" src="./assets/first_start/start_button.png"/>    
					<img id="gamehelpimg" src="./assets/first_start/help_button.png"/>    
					<img id="sollogoimg" src="./assets/first_start/start_sol.png"/>    
				 	<a-mixin
					id="shinhanlogo"
					geometry="primitive: plane; width: 1.31; height: 0.91"
					material="src: #shinhanlogoimg; shader: flat; transparent: true"
					position="0 3 -5.0"
					></a-mixin>			   
					<a-mixin
					id="sollogo"
					geometry="primitive: plane; width: 1.24; height: 1.64"
					material="src: #sollogoimg; shader: flat; transparent: true"
					position="0 2 -5.0"
					></a-mixin>			   
					<a-mixin
					id="startgame"
					geometry="primitive: plane; width: 1.2; height: 0.42"
					material="src: #startgameimg; shader: flat; transparent: true"
					position="0 0 -5.0"
					></a-mixin>			   
					<a-mixin
					id="gamehelp"
					geometry="primitive: plane; width: 1.22; height: 0.38"
					material="src: #gamehelpimg; shader: flat; transparent: true"
					position="0 -0.5 -5.0"
					></a-mixin>			   
				</a-assets>
-->				
			<a-camera id='camera1' look-controls-enabled='true' arjs-look-controls='smoothingFactor: 0.1' gyro-camera rotation-reader>
				<a-entity id="ui" position="0 0 0">
						<!-- Poster menu 
						<a-entity id="menu" highlight>
							<a-entity id="firstux" mixin="shinhanlogo" visible="true"></a-entity>
							<a-entity id="firstux3" mixin="sollogo" visible="true"></a-entity>
							<a-entity id="firstux1" mixin="startgame" visible="true"></a-entity>
							<a-entity id="firstux2" mixin="gamehelp" visible="true"></a-entity>
						</a-entity>
-->
					<a-entity text="value: version 0.2.3.6" position="0 1.0 -2.1"></a-entity>
				</a-entity>
				<a-entity 
					id="gun" 
					shooter 
					gltf-model="url(./assets/bow.gltf)" 
					scale="4.0 4.0 4.0" 
					animation-mixer="clip: shoot; loop: repeat;" 
					brandon-shoot
					visible="false"
					position="0 -0.6 -1">
				</a-entity>			  
			<a-entity id="bgm" sound="src: #background"></a-entity>
				<a-entity id="misssound" sound="src: #miss"></a-entity>
				<a-entity id="countdownsound" sound="src: #countdown"></a-entity>
				<a-entity id="startbell" sound="src: #startsound"></a-entity>
			</a-camera>
</a-scene>
<!--
	<div id="titlescene" class="centered">
    <button data-action="change"></button>
	</div>
-->	
	<div id="titlescene" class="titlebackground">
		<!-- 첫번째 UX 화면 --> 
		<div id="firstux" style="display: none;">
			<img style="position:absolute; display: flex; width:100%; height:100%; top: 0; left: 0;" src="./assets/first_start/background.png"/>

			<div id="startgamebutton" style="position:absolute; display: flex; width:105px; height:39; top: 500px; left: 30%;">
				<img src="./assets/first_start/start_button.png"/>    
			</div>
			<div id="helpbutton" style="position:absolute; display: flex; width:101px; height:37; top: 600px; left: 30%;">
				<img src="./assets/first_start/help_button.png"/>    
			</div>
		</div>
		<!-- 도움말 UX 화면 --> 
		<div id="helpux" style="display: none;">
			<img style="position:absolute; display: flex; width:100%; height:100%; top: 0; left: 0;" src="./assets/second_game/help_back.png"/>

			<div id="helpokbutton" style="position:absolute; display: flex; width:105px; height:39; top: 500px; left: 30%;">
				<img src="./assets/third_qa/ok_button.png"/>    
			</div>
		</div>

		<div id="countdowntext" style="display: none;">
			<p id="countdowndetail" style="color: white; font-size: 100px; text-align: center; align-items: center; justify-content: center; width:90%;">3!</p>
		</div>



		<!-- 게임 UX 화면 --> 
		<div id="gameux" style="display: none;">
			<img style="position:absolute; display: flex; width:100%; height:20%; top: 0; left: 0;" src="./assets/second_game/topbar_back.png"/>
			<img style="position:absolute; display: flex; width:84px; height:84px; top: 50%; left: 50%;" src="./assets/second_game/crosshair.png"/>

	    <button data-action="change"></button>

			<div id="shootbutton" style="position:absolute; display: flex; width:105px; height:39; top: 80%; left: 30%;">
				<img src="./assets/third_qa/ok_button.png"/>    
			</div>
		</div>
		<!-- 퀴즈 UX 화면 --> 
		<div id="quizux" style="display: none;">
			<img style="position:absolute; display: flex; width:100%; height:50%; top: 30%; left: 0;" src="./assets/third_qa/quiz_back.png"/>

			<p id="quiztext" style="position:absolute; display: flex; width:90%; height:50%; top: 32%; left: 20px;">디지로그 서소문에서 세무, 부동산, 해외투자 전문가와 상담을 무료로 제공하고 있다.</p>

			<div id="obutton" style="position:absolute; display: flex; width:117px; height:45; top: 90%; left: 10%;">
				<img src="./assets/third_qa/O_button.png"/>    
			</div>
			<div id="xbutton" style="position:absolute; display: flex; width:117px; height:45; top: 90%; right: 10%;">
				<img src="./assets/third_qa/X_button.png"/>    
			</div>
		</div>

		
	</div>


</body>